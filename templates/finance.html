{% extends 'base.html' %}
{% block title %}Finance{% endblock %}

{% block content %}
  <h1>Finance</h1>
  <div class="row">
    <div class="col-md-4">
      There will be a cool chart here
    </div>
    <div class="col-md-4">
      Another cool chart
    </div>
    <div class="col-md-4">
      {% for debt in owes[get_roommate_id(current_user.name)] %}
        {% if loop.index0 != get_roommate_id(current_user.name) %}
          {% if debt > 0 %}
            You owe {{ get_roommate_name(loop.index0) }} <b>{{ money_format(debt) }}</b><br />
          {% else %}
            {{ get_roommate_name(loop.index0) }} owes you <b>{{ money_format(owes[loop.index0][get_roommate_id(current_user.name)]) }}</b><br/>
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>
  </div>
  <h4>{{ recent_purchases|length }} most recent purchases</h4>
  <table class="table table-striped table-hover">
    <thead>
      <tr><th scope="col">Item</th><th scope="col">Who</th><th scope="col">Price</th><th scope="col">For</th><th scope="col">Split</th><th scope="col">?</th></tr>
    </thead>
    <tbody>
      {% for item in recent_purchases %}
        <tr>
          <td><a href="/purchase/view/{{ item.id }}">{{ item.name }}</a></td>
          <td>{{ get_roommate_name(item.bought_by) }}</td>
          <td>{{ money_format(item.price) }}</td>
          <td>{{ votes_to_string(item.bought_for) }}</td>
          <td>{{ capitalize(item.split_mode) }}</td>
          <td><a href="/purchase/edit/{{ item.id }}">Edit</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <a class="btn btn-primary" href="/purchase/add">+ Add</a> <a class="btn btn-secondary" href="/purchase/view/all">See all</a> <br /><br />
  <h4>{{ recent_moneytransfers|length }} most recent money transfers</h4>
  <table class="table table-striped table-hover">
    <thead>
      <tr><th scope="col">Reason</th><th scope="col">Who paid</th><th scope="col">To whom</th><th scope="col">How much</th><th scope="col">When</th></tr>
    </thead>
    <tbody>
      {% for item in recent_moneytransfers %}
        <tr>
          <td><a href="/moneytransfer/view/{{ item.id }}">{{ item.name }}</a></td>
          <td>{{ get_roommate_name(item.who_paid) }}</td>
          <td>{{ get_roommate_name(item.to_whom) }}</td>
          <td>{{ money_format(item.amount) }}</td>
          <td>{{ time_conv(item.transferred_when) }}</td>
          <td><a href="/moneytransfer/edit/{{ item.id }}">Edit</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <a class="btn btn-primary" href="/moneytransfer/add">+ Add</a> <a class="btn btn-secondary" href="/moneytransfer/view/all">See all</a> <br /><br />
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css">
{% endblock %}
